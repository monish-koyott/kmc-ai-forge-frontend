@using System.ComponentModel.DataAnnotations
@using KmcAiBlazorApp.Models
@using System.Text.Json
@rendermode InteractiveServer

<div class="document-upload-section">
    <!-- Demo Scenario -->
    <div class="demo-scenario">
        <div class="demo-indicator">
            <div class="demo-dot"></div>
            <span>Demo Scenario Active</span>
        </div>
        <p class="demo-text">Running: Missing Documents scenario</p>
    </div>
    
    <!-- How to use -->
    <div class="how-to-use">
        <h3>How to use this tool:</h3>
        <ol>
            <li><strong>Upload Documents:</strong> Drag and drop or click to upload your portfolio documents for validation.</li>
            <li><strong>View Results & Take Action:</strong> Review the validation results and take the necessary actions.</li>
        </ol>
    </div>
    
    <!-- Document Upload Area -->
    <div class="upload-area">
        <h3>Document Upload</h3>
        <p class="upload-subtitle">Upload your documents for portfolio validation.</p>
        
        <!-- File input with proper event binding -->
        <InputFile @ref="fileInput" OnChange="HandleFileSelection" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.xls,.xlsx" class="hidden-file-input" />
        
        <!-- Clickable drop zone with multiple event handlers -->
        <div id="drop-zone" class="drop-zone" 
             @onclick="HandleClick"
             @onclick:preventDefault="true">
            <div class="upload-content">
                <div class="upload-icon">↑</div>
                <h4>Upload Documents</h4>
                <p>Drag and drop your files here, or click anywhere to browse.</p>
                <div class="supported-formats">
                    <p><strong>Examples:</strong> FMA, Portfolio Form, ASTs, Equifax Commercial Credit Search, Mortgage Statements, Bank Statements</p>
                    <p><strong>Supported formats:</strong> PDF, DOC, DOCX, JPG, PNG, XLS, XLSX</p>
                </div>
                
                <!-- Visual button indicator -->
                <div class="file-input-container">
                    <div class="upload-btn-indicator">
                        <span>Click anywhere to choose files</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ready to Process -->
    @if (UploadedFiles.Any())
    {
        <div class="ready-to-process">
            <div class="ready-content">
                <div class="ready-indicator">
                    <span class="checkmark">✓</span>
                </div>
                <div class="ready-text">
                    <p>Ready to Process</p>
                    <p class="subtitle">@UploadedFiles.Count document@(UploadedFiles.Count == 1 ? "" : "s") ready for validation processing.</p>
                </div>
            </div>
            <button class="process-btn" @onclick="StartProcessing" disabled="@isProcessing">
                @if (isProcessing)
                {
                    <span>Processing...</span>
                }
                else
                {
                    <span>Start Processing</span>
                }
            </button>
        </div>
    }
    
    <!-- Processing Modal -->
    <ProcessingModal 
        @ref="processingModal"
        @bind-IsVisible="showProcessingModal"
        CancelProcessingRequested="HandleCancelProcessing"
        ViewResultsRequested="HandleViewResults" />
</div>
